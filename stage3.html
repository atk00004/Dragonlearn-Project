<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Landing space</title>
    <link rel="stylesheet" href="./stage3.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
</head>

<body>
    <div id="holder" class="holder">
        <div class="droppable"></div>
        <div class="droppable"></div>
        <div class="bar" draggable="true"></div>
    </div>
    <div class="holder">
        <div class="droppable"></div>
        <div class="droppable"></div>
    </div>
    <p id="chieudai"></p>


    <script>
        let currentDroppable = null;
        let bar = holder.querySelector('.bar');

        bar.onmousedown = function (event) {

            let shiftY = event.clientY - bar.getBoundingClientRect().top;

            bar.style.position = 'absolute';


            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);

            function moveAt(clientY) {
                if (clientY - shiftY - 8 < 0) {
                    bar.style.top = 0 + 'px';
                    return;
                }
                if (clientY - shiftY - 8 > 340) {
                    bar.style.top = 340 + 'px';
                    return
                }
                bar.style.top = clientY - shiftY - 8 + 'px';

            }

            function onMouseMove(event) {

                moveAt(event.clientY);

                bar.style.visibility = "hidden";

                let elemBelow = document.elementFromPoint(event.clientX, event.clientY);


                bar.style.visibility = "visible";

                if (!elemBelow) return;

                let droppableBelow = elemBelow.closest('.droppable');


                if (currentDroppable != droppableBelow) {
                    if (currentDroppable) {

                        leaveDroppable(currentDroppable);

                    }

                    currentDroppable = droppableBelow;

                    console.log(currentDroppable);


                    if (currentDroppable) {
                        enterDroppable(currentDroppable);
                    }
                    if (bar.style.top == '0px') {
                        showPicture(currentDroppable);

                    }
                }
            }
            function enterDroppable(elem) {

                //elem.style.backgroundImage = "url('./Images/44.png')";
                elem.style.background = 'pink';
            }

            function leaveDroppable(elem) {
                elem.style.backgroundImage = '';
            }

            function showPicture(elem) {

                document.getElementById("chieudai").innerHTML = "HELLO";
                var image_1 = document.createElement("div");

                image_1.className = 'image_1';

                image_1.style.backgroundImage = "url('./Images/51_2.png')";

                elem.appendChild(image_1);
            }


            function onMouseUp() {
                document.removeEventListener('mouseup', onMouseUp);
                document.removeEventListener('mousemove', onMouseMove);
            }

        };

        bar.ondragstart = function () {
            return false;
        };
    </script>
</body>

</html>